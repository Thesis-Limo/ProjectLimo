#!/bin/bash
xhost +
function build {
	docker build -t thesis .
}

function startsim {
    clean gazebo
    clean rvizlimo
    clean terminal
    clean roscore
	docker compose up -d roscore terminal rviz gazebo
}

function terminal {
    sudo docker compose up -d terminal
	sudo docker exec -it terminal /bin/zsh
}
function rviz {
    clean rviz
    sudo docker compose up -d rviz
	sudo docker exec -it rviz /bin/zsh
}

function clean {
    PREFIX=$1
    shift
    if [ -z "$PREFIX" ]
    then
        echo "Please provide a prefix."
        exit 1
    fi
    
    CONTAINERS=$(docker ps -q --filter name=$PREFIX*)
    
    if [ -n "$CONTAINERS" ]; then
        echo "$CONTAINERS" | xargs docker rm -f
    else
        echo "No containers found matching the filter criteria."
    fi
}

function stop {
    sudo docker compose down
    clean thesis
}


function help {
    echo "$0 <task> <args>"
    echo "Tasks:"
    compgen -A function | cat -n
}

function PRINT_MENU()
{
    echo -e "\e[1;10H Menu"
    echo -e "1.Build images"
    echo -e "2.Start sim"
    echo -e "3.Start terminal"
    echo -e "4.Start rviz"
    echo -e "5.Stop"

    echo -n "Your chose(1-5):"
}

PRINT_MENU

read CHOOSE

case "${CHOOSE}" in
    1)
    build
    ;;
    2)
    startsim
    ;;
    3) 
    terminal
    ;;
    4)
    rviz
    ;;
    5)
    stop
    ;;
esac    